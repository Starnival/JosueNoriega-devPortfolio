---
// src/components/sections/ProjectCard.astro
import { Image } from 'astro:assets';
const { project } = Astro.props;
---

<div class="project-card">
    <div class="project-card-content">
        <div class="card-image-container">
            <Image
                src={project.imageURL}
                alt={`Imagen del proyecto ${project.name}`}
                class="project-image"
                width={285}
                height={160}
                format="webp"
                quality={80}
                widths={[150, 300]}
                sizes="(max-width: 768px) 100vw, 285px"
                loading="eager"
            />
        </div>

        <div class="card-content-container">
            <header class="card-header">
                <h3 class="card-name">{project.name}</h3>
                <time class="card-date">{project.startDate} - {project.endDate}</time>
            </header>
            <p class="card-description">{project.tagline}</p>
            <div class="tech-list-row">
                {
                    project.technologies &&
                        project.technologies.map((tech: unknown) => <span class="tech-tag">{tech}</span>)
                }
            </div>
            <button class="read-more-button" data-project-id={project.id} type="button"> Ver detalles &rarr; </button>
        </div>
    </div>
</div>

<script>
    // Usamos el evento 'DOMContentLoaded' para asegurarnos de que el DOM est√© cargado.
    // Usamos 'querySelectorAll' para evitar conflictos si hay m√∫ltiples ProjectCard.
    document.addEventListener('DOMContentLoaded', () => {
        const buttons = document.querySelectorAll('.read-more-button');

        buttons.forEach((button) => {
            // ‚ö†Ô∏è SOLUCI√ìN TS: Forzamos el tipado a HTMLButtonElement para acceder a 'dataset'
            const buttonElement = button as HTMLButtonElement;

            buttonElement.addEventListener('click', () => {
                // Leemos el ID del proyecto desde el data-attribute
                // ‚ö†Ô∏è Se pasa 'projectId'
                const projectId = buttonElement.dataset.projectId;

                if (projectId) {
                    // ...
                    // 2. Disparar un evento personalizado con el ID del proyecto
                    document.dispatchEvent(
                        new CustomEvent('openProjectModal', {
                            detail: { projectId: projectId }, // <--- Usa projectId
                        }),
                    );
                }
            });
        });
    });
</script>

<style>
    .project-card {
        height: 100%;
        width: 100%;
        text-align: left;
        /* Neumorfismo Inicial (Relieve Suave) */
        background-color: var(--fondo-secundario);
        color: var(--texto-principal);
        border-radius: 16px;
        transition:
            box-shadow 0.3s ease-in-out,
            transform 0.3s ease-in-out;

        /* Aplicamos el Neumorfismo Saliente Sutil */
        box-shadow:
            inset 4px 4px 8px var(--sombra-oscura-fuerte),
            inset -4px -4px 8px var(--sombra-clara-suave);

        &:hover {
            transform: scale(1.05);
        }
    }
    .project-card-content {
        display: flex;
        flex-direction: column;
        height: 100%;
        padding: 1rem;
        gap: 1rem;
    }

    .project-image {
        width: 100%;
        height: 100%;
        object-fit: cover; /* Asegura que la imagen cubra el contenedor sin deformarse */
        display: block;
        transition: transform 0.3s ease-in-out; /* Mantenemos la transici√≥n de la imagen */
        border-radius: 10px; /* Redondeamos la imagen tambi√©n */
    }

    .project-card:hover .project-image {
        transform: scale(1.05);
    }

    /* --- Imagen --- */
    .card-image-container {
        /* Contenedor para manejar el aspecto de la imagen */
        width: 100%;
        aspect-ratio: 16 / 9; /* Proporci√≥n panor√°mica para la imagen */
        overflow: hidden;
        border-radius: 10px;
        display: flex; /* Para centrar la imagen si no llena el espacio */
    }

    /* Estilos internos de la tarjeta */
    .card-name {
        width: max-content;
        font-size: var(--text-size-paragraph);
        font-weight: 700;
        color: var(--acento-primario); /* Destaca el nombre del proyecto */
        padding: 5px 10px;

        /* Neumorfismo ultra-sutil para el tag */
        border-radius: 16px;
        transition:
            box-shadow 0.3s ease-in-out,
            transform 0.3s ease-in-out;

        /* Aplicamos el Neumorfismo Saliente Sutil */
        box-shadow:
            4px 4px 8px var(--sombra-oscura-fuerte),
            -4px -4px 8px var(--sombra-clara-suave);
    }
    .card-content-container {
        display: flex;
        flex-direction: column;
        flex-grow: 1; /* Ocupa el espacio restante */
    }
    .card-header {
        margin-bottom: 0.5rem;
    }
    .card-date {
        font-size: 0.8rem;
        color: var(--texto-secundario);
        margin-top: 0;
        margin-bottom: 0.8rem;
    }

    .card-description {
        color: var(--texto-secundario);
        flex-grow: 1; /* Permite que la descripci√≥n empuje el footer hacia abajo */
        margin-top: 0;
        font-size: 0.9rem;
        margin-bottom: 0.75rem;
    }

    .read-more-button {
        all: unset; /* Reseteamos estilos de bot√≥n */
        cursor: pointer;
        display: inline-block;
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--interactivo); /* Usa el color interactivo para el CTA */
        align-self: flex-end; /* Alinea el bot√≥n a la derecha */
        border-top: 1px solid var(--sombra-clara-suave); /* Separador sutil */
        padding-top: 0.5rem;
        margin-top: 0.5rem; /* Menos espacio si las tecnolog√≠as est√°n cerca */
        transition: color 0.3s ease;
        width: 100%;
        text-align: right;
    }

    .read-more-button:hover,
    .read-more-button:focus {
        color: var(--acento-primario);
        outline: none;
    }

    .read-more-button:focus-visible {
        text-decoration: underline;
    }

    /* üí° LISTA DE TECNOLOG√çAS (Row Sutil) */
    .tech-list-row {
        display: flex;
        flex-wrap: wrap; /* Si hay muchas, bajan a la siguiente l√≠nea */
        gap: 0.5rem;
        margin-bottom: 0.75rem;
    }

    .tech-tag {
        font-size: 0.75rem; /* Peque√±o y sutil */
        font-weight: 500;
        color: var(--acento-primario);
        background-color: var(--fondo-principal); /* Un color ligeramente diferente */
        padding: 0.2rem 0.6rem;
        /* Neumorfismo ultra-sutil para el tag */
        border-radius: 16px;
        transition:
            box-shadow 0.3s ease-in-out,
            transform 0.3s ease-in-out;

        /* Aplicamos el Neumorfismo Saliente Sutil */
        box-shadow:
            4px 4px 8px var(--sombra-oscura-fuerte),
            -4px -4px 8px var(--sombra-clara-suave);
    }
</style>
